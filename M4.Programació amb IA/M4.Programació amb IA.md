---
title: "Programació d'aplciacions amb IA"
author: [CEFIRE DE VALÈNCIA]
date: "01-02-2024"
subject: "IA"
keywords: [IA]
subtitle: "Curs a distància"
lang: "es"
page-background: "background10.pdf"
titlepage: true,
titlepage-rule-color: "360049"
titlepage-background: "background10.pdf"
colorlinks: true
toc: true
toc-own-page: true
header-includes:
- |
  ```{=latex}
  \usepackage{awesomebox}
  \usepackage{caption}
  \usepackage{array}
  \usepackage{tabularx}
  \usepackage{ragged2e}
  \usepackage{multirow}
  \usepackage{xcolor}

  ```
pandoc-latex-environment:
  noteblock: [note]
  tipblock: [tip]
  warningblock: [warning]
  cautionblock: [caution]
  importantblock: [important]
...

<!-- \awesomebox[violet]{2pt}{\faRocket}{violet}{Lorem ipsum…} -->

<!-- \awesomebox[violet]{2pt}{\faRobot}{violet}{Lorem ipsum…} -->

<!-- IMATGE ![Pregunta inicial](./img/proxi/5b.png) -->

<!-- \textbf{greatest} -->

<!-- \awesomebox[violet]{2pt}{\faRobot}{violet}{\textbf{greatest}} -->

\vspace*{\fill}

![](img/cc.png){ height=50px }

Aquest document està subjecte a una llicència creative commons que permet la seua difusió i ús comercial reconeixent sempre l'autoria del seu creador. Aquest document es troba per a ser modificat al següent repositori de github:
<!-- CANVIAR L'ENLLAÇ -->
[https://github.com/alviboi/curshumanitatsmodulII](https://github.com/alviboi/curshumanitatsmodulII)
\newpage

# Introducció

En aquesta unitat el primer que anem a demanar-vos és que no vos poseu nerviosos ni vos desespereu, però quan parlem d'inteligència artificial hem de parlar de una de les seues principals funcions i que veritablement està revolucionant molts aspectes de la vida professional de molts treballadors. 

En aquest cas anem a realitzar un aplicació amb un llenguatge de programació molt conegut com és Python, i no, no cal que sapigueu programar, no cal que entengueu el que diu, però seguint les intruccions que ens anirà donant la plataforma farem una aplicació.

# Objectiu

El nostre objectiu va a ser crear una aplicació que active la càmera web del nostre oridnador i active si estem somriguent o estem tristos.

Per a realitzat aquesta aplicació hem de conèixer en quin sistema operatiu anem a crear-lo ja que no només ens farà falta el codi sino com executar-lo. Per a aquest fi utilitzarem únicament Bing Copilot ja que és la que, en principi funciona millor per a programar.

# Realització

Per a crear un programa amb python hem de pegar el codi a una arxiu de text (.txt, no val ni .doc ni .odt) i guardar-lo.

Plantejarem un prompt com aquest:

\awesomebox[violet]{2pt}{\faRobot}{violet}{Eres un programador experimentat que li agrada documentar el seu codi i treballa amb linux. La nostra vida depén de realitzar un programa amb python que obrirà una finestra que ens mostrarà el que hi ha a la càmera web del nostre ordinador. Aquest programa detectarà quan la nostra cara somriu i quan està trista i mostrarà un missatge a la pantalla que anirà refrescant-se cada segon mostrant el text "trist" o "alegre"}

Copiem i peguen el que ens diu exactament ja que és tracta d'una resposta bastant llarga:


Hola! Com que vols fer un programa que detecti emocions a través de la càmera web del teu ordinador, et recomano que utilitzis la llibreria **OpenCV** per a Python. Aquesta llibreria és una eina de codi obert que es pot utilitzar per a la visió per computador i el processament d'imatges. Per a la detecció d'emocions, pots utilitzar el reconeixement facial en temps real amb **OpenCV**. Això implica la detecció de cares i la identificació de les emocions a través de les expressions facials.

Per a la detecció d'emocions, et recomano que utilitzis el model **FER+** (Face Expression Recognition Plus) que és un model de xarxa neuronal que es pot entrenar per a la detecció d'emocions a través de les expressions facials. Aquest model es pot utilitzar amb **OpenCV** per a la detecció d'emocions en temps real.

A continuació, et proporciono un exemple de codi que utilitza **OpenCV** i **FER+** per a la detecció d'emocions a través de la càmera web del teu ordinador:

```python
import cv2
import numpy as np
from fer import FER

cap = cv2.VideoCapture(0)
detector = FER(mtcnn=True)

while True:
    ret, frame = cap.read()
    if not ret:
        break

    # Detect faces in the frame
    faces = detector.detect_emotions(frame)

    # Draw bounding boxes and labels of detected faces
    for face in faces:
        x, y, w, h = face["box"]
        emotions = face["emotions"]
        emotion = max(emotions, key=emotions.get)
        cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 0), 2)
        cv2.putText(frame, emotion, (x, y - 10), cv2.FONT_HERSHEY_SIMPLEX, 0.9, (0, 255, 0), 2)

    # Display the resulting frame
    cv2.imshow("Emotion Detection", frame)

    # Exit if the user presses 'q'
    if cv2.waitKey(1) & 0xFF == ord("q"):
        break

# Release the capture and destroy the window
cap.release()
cv2.destroyAllWindows()
```

Aquest codi obre la càmera web del teu ordinador i detecta les cares en temps real. A continuació, utilitza el model **FER+** per a la detecció d'emocions a través de les expressions facials. El codi dibuixa quadres delimitadors i etiquetes de les cares detectades i mostra el text "alegre" o "trist" a la pantalla, depenent de l'emoció detectada.

Espero que això t'ajudi a començar a desenvolupar el teu programa! Si tens alguna pregunta més, no dubtis a preguntar-me.

Origen: Conversación con Bing, 29/1/2024
(1) Facial Emotion Recognition In Real-Time - LearnOpenCV. https://learnopencv.com/facial-emotion-recognition/.
(2) facial-emotion-recognition · GitHub Topics · GitHub. https://github.com/topics/facial-emotion-recognition?l=python.
(3) Emotion Detection using Python - Geeky Humans. https://geekyhumans.com/emotion-detection-using-python-and-deepface/.
(4) ajitharunai/Facial-Emotion-Recognition-with-OpenCV-and-Deepface. https://github.com/ajitharunai/Facial-Emotion-Recognition-with-OpenCV-and-Deepface/.
(5) Real-time Facial Emotion Recognition using OpenCV and Deepface. https://github.com/SaeedTaghavi/Facial-Emotion-Recognition-with-OpenCV-and-Deepface/blob/main/README.md.

Nosaltres només volem el codi, axií que el copiem i peguem en un arxiu de text anomenat camera.py i executem a la terminal:

```
python camera.py
```

Però ens dona un error i no funciona. Així que recurrim a Bing Copilot per veure que ens diu:

![Resposta de Copilot](img/0.png){ height=50px }

Així, executem el que ens diu la IA i tornem a executar:

```python
python camera.py
```
I aquest és el resultat:

![Resposta de Copilot](img/1.png){ height=50px }

![Resposta de Copilot](img/2.png){ height=50px }

![Resposta de Copilot](img/3.png){ height=50px }

![Resposta de Copilot](img/4.png){ height=50px }


# Anem a crear un joc amb python també

Crear un joc no és una tasca senzilla i anem a utilitzar uan biblioteca de python anomenada pygame que és molt senzilla d'utilitzar. Personalment no l'he utilitzada mai. Però podrem veure que no només hi ha que realitzar un comandament per a realitzar el joc sinó que hi haurà que anar donant-li instruccions per a que vaja canviant les coses que no entén del que nosaltres volem.

:::caution
La creació d'un videojoc comporta moltes vegadades anys, i jocs senzills potser no anys però mesos dedicats en exclusiva, així que no esperem traure una meravella de joc amb un dia, així i tot els resultats són bastant sorprenents.
:::

Pot semblar una tasca senzilla tal i com vaig a plantejar-vos-ho, però el prompt que he creat per a que la IA em cree el videojoc he tingut que modifcar-lo un poc (i després he modificat un poc el codi) per a que em funcione correctament. A més com hem comentat sempre és important conèixer un poc (encara que siga molt poc) de què estem tractant amb la IA per a poder perfilar millor el prompt. 

La plataforma que hem utilitzat és Bing Copilat amb el seu mode més precís i el prompt plantejat ha sigit el següent:

awesomebox[violet]{2pt}{Crea un joc amb la bilioteca pygame per a python que tinga una pantalla estàtica amb una plataforma del 20% del total de la finestra que puga desplaçar a l'esquerra o la dreta amb el teclat de manera suau i ràpida. La velocitat de la bola será constant de 1 i que s'actualitze la funció que mou la bola cada 0.3 segons i quan la bola xoque amb els extrems de la pantalla rebotarà amb un angle de 45º en la direcció que du, si la bola xoca contra la plataforma rebotarà, si rebota en la meitat dreta de la plataforma se n'anirà cap a la dreta amb un angle de 45º cap a dalt i si rebota en la meitat esquerra de la plataforma se n'anirà cap a l'esquerre amb un angle de 45º cap a dalt. Al començament hi haurà una bola damunt de la tabla sense moure's i quan es polse la tecla espai la bola començarà a moure's cap a dalt. Escriure-me el codi només, sense comentaris i de la manera més resumida possible. No vull que m'escrigues cap explicació, només vull el codi i sense comentaris.}

La resposta tal cual ha sigut:

![Resposta de Copilot](img/8.png)

Vos transcribim el codi ací

```python
import pygame
import math

pygame.init()

WIDTH, HEIGHT = 800, 600
BALL_RADIUS = 10
PADDLE_WIDTH = WIDTH * 0.2
PADDLE_HEIGHT = 10
BALL_SPEED = 1
PADDLE_SPEED = 2
FPS = 60
ANGLE = 45

win = pygame.display.set_mode((WIDTH, HEIGHT))
clock = pygame.time.Clock()

class Ball:
    def __init__(self):
        self.x = WIDTH / 2
        self.y = HEIGHT - PADDLE_HEIGHT - BALL_RADIUS
        self.speed = BALL_SPEED
        self.angle = math.radians(-ANGLE)

    def move(self):
        self.x += self.speed * math.cos(self.angle)
        self.y += self.speed * math.sin(self.angle)

    def draw(self):
        pygame.draw.circle(win, (255, 255, 255), (int(self.x), int(self.y)), BALL_RADIUS)

class Paddle:
    def __init__(self):
        self.x = WIDTH / 2 - PADDLE_WIDTH / 2
        self.y = HEIGHT - PADDLE_HEIGHT
        self.speed = PADDLE_SPEED

    def move(self, key):
        if key[pygame.K_LEFT] and self.x - self.speed > 0:
            self.x -= self.speed
        if key[pygame.K_RIGHT] and self.x + self.speed < WIDTH - PADDLE_WIDTH:
            self.x += self.speed

    def draw(self):
        pygame.draw.rect(win, (255, 255, 255), pygame.Rect(self.x, self.y, PADDLE_WIDTH, PADDLE_HEIGHT))

def main():
    run = True
    ball = Ball()
    paddle = Paddle()
    space_pressed = False

    while run:
        clock.tick(FPS)
        key = pygame.key.get_pressed()
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                run = False
            if event.type == pygame.KEYDOWN and event.key == pygame.K_SPACE:
                space_pressed = True

        if space_pressed:
            ball.move()
            if ball.y - BALL_RADIUS < 0 or (ball.y + BALL_RADIUS > paddle.y and paddle.x < ball.x < paddle.x + PADDLE_WIDTH):
                ball.angle = -ball.angle
            elif ball.x - BALL_RADIUS < 0 or ball.x + BALL_RADIUS > WIDTH:
                ball.angle = math.pi - ball.angle

        paddle.move(key)

        win.fill((0, 0, 0))
        ball.draw()
        paddle.draw()
        pygame.display.update()

    pygame.quit()

if __name__ == "__main__":
    main()
```

Aquest és el codi generat i el resultat ha sigut el següent:

![Joc plantejat](img/7.png)

El problema que hem detectat és que la bola anava molt lentament, en este cas nosaltres hem decidit canviat la tasa de refrescament de la pantalla que al prompt ho hem deixat com a: *i que s'actualitze la funció que mou la bola cada 0.3 segons*, i finalment li hem donat un valor de 120. 

Però li hem preguntat a Copilot i la resposta ha sigut igualment vàlida o inclús més lògica:

![Canvi de velocitat](img/9.png)

:::tip
Hem canviat el valor de BALL_SPEED a 5 i el joc ha millorat bastant
:::

## Explicació del prompt

Anem a fer una xicoteta explicació del prompt, com podeu vore els prompts no solen ser "Fes-me un joc tipo *Arkanoid*", cal detallar clarament el que volem.

:::note
És possible que ara ja haja deprés que el joc Arkanoid està relacionat amb el prompt que he preguntat després i ja ho haja associat i a volsatres vos funcione. La IA va aprenent també del que nosaltres li "ensenyem"
:::

El prompt que hem plantejat és:

>Crea un joc amb la bilioteca pygame per a python que tinga una pantalla estàtica amb una plataforma del 20% del total de la finestra que puga desplaçar a l'esquerra o la dreta amb el teclat de manera suau i ràpida. La velocitat de la bola será constant de 1 i que s'actualitze la funció que mou la bola cada 0.3 segons i quan la bola xoque amb els extrems de la pantalla rebotarà amb un angle de 45º en la direcció que du, si la bola xoca contra la plataforma rebotarà, si rebota en la meitat dreta de la plataforma se n'anirà cap a la dreta amb un angle de 45º cap a dalt i si rebota en la meitat esquerra de la plataforma se n'anirà cap a l'esquerre amb un angle de 45º cap a dalt. Al començament hi haurà una bola damunt de la tabla sense moure's i quan es polse la tecla espai la bola començarà a moure's cap a dalt. Escriure-me el codi només, sense comentaris i de la manera més resumida possible. No vull que m'escrigues cap explicació, només vull el codi i sense comentaris.

> Crea un joc amb la bilioteca pygame per a python

Hem de detallar la tecnlogia que volem utiltizar, ací estem plantejant un context en el nostre prompt

> que tinga una pantalla estàtica amb una plataforma del 20% del total de la finestra 

En aquest cas continuem detallant el context, podríem haver demanat una pantalla més xicoteta però ha supossat una pantalla de 800x600, si que li indiquem que la finestra tinga un tamany determinat i volem una plataforma que és on rebotaran les boles. Vegeu que li done ja un valor, com que no li he donat un valor a la pantalla li parle en percentatges.

> que puga desplaçar a l'esquerra o la dreta amb el teclat de manera suau i ràpida. 

Li deixem clar que volem manejar la plataforma amb el teclat i no amb el ratolí, especifiquem suau i ràpida per a que entenga que si mantenim polsat la tecla volem que continue, en aquest cas m'ha funcionat però amb altres models GPT no entén *suau i ràpida* 

> La velocitat de la bola será constant de 1 i que s'actualitze la funció que mou la bola cada 0.3 segons 

Aquesta part pot costar d'entendre un poc més, el FPS és la velocitat amb la que vull que es refresque la pantalla i li ho he dit en segons que la IA a interpretat 60 fps, i al velocitat 1 perquè pygame només permet valors majors de 1.

> i quan la bola xoque amb els extrems de la pantalla rebotarà amb un angle de 45º en la direcció que du

És important delimitar com rebota, ací és quan li donem exemples a la IA per a que entenga que ha de rebotar en una direcció diferent, sino podria quedar-se rebotant d'un costat a altre sense canviar. Cal pensar en la dinàmica del joc.

>si la bola xoca contra la plataforma rebotarà, si rebota en la meitat dreta de la plataforma se n'anirà cap a la dreta amb un angle de 45º cap a dalt i si rebota en la meitat esquerra de la plataforma se n'anirà cap a l'esquerre amb un angle de 45º cap a dalt. 

Continuem amb els exemples que ajuden a entendre què és el que desitgem.

> Al començament hi haurà una bola damunt de la tabla sense moure's i quan es polse la tecla espai la bola començarà a moure's cap a dalt. 

Cal definir una situació inicial ja que, com ja hem comentat, la IA no pressuposa com un humà, sino especifiquem alguna cosa s'ho inventarà i podria ser que no fos el que desitgem

> Escriure-me el codi només, sense comentaris i de la manera més resumida possible. No vull que m'escrigues cap explicació, només vull el codi i sense comentaris.

Per últim insistim que només volem el codi sense cap tipus d'explicació i sense cap tipus de comentari al codi. Els comentaris ens poden ajudar a entendre millor el codi, però la plataforma té limitat el número de caràcters que ens dona com a resposta, d'aquesta manera estaviem quantitat de caràcters que volem que ens done.

:::warning
Creant aquest prompt, en una de les proves la IA em va contestar:

![La IA fent amics](img/10.png)

Així que no sempre obtindrem el resultats esperats i caldrà anar modificant variables fins que ens done el resultat esperat.
:::

# Més possiblitats

Les possibilitats per a programar en qualsevol framework són infinites i poden tindre un professor les 24h disponible per anar preguntant allò que necessitem, però cal saber què preguntar. Es podria haver utilitzat una plataforma professional com Unity que caldria instal·lar i programar amb ella és més complexe ja que no és només codi. Així i tot hi han molts exemples en la xarxa de crear un joc amb Unity però cal anar preguntant poc a poc i dient "I ara que faig?".

L'única limitació que tenim és el temps que podem dedicar-li.